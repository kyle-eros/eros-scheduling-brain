config {
  type: "assertion",
  schema: "eros_assertions",
  description: "mass_messages: max(sending_date) within last 24h",
  tags: ["data_quality","freshness"]
}
WITH s AS (
  SELECT MAX(sending_date) AS max_dt
  FROM ${ref("mass_messages")}
  WHERE sending_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 14 DAY)
)
SELECT *
FROM s
WHERE COALESCE(max_dt, DATE '1900-01-01') < DATE_SUB(CURRENT_DATE(), INTERVAL 1 DAY)