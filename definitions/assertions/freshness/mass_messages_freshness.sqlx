config {
  type: "assertion",
  schema: "eros_assertions",
  description: "Mass messages must be fresh within 24 hours",
  tags: ["data_quality", "freshness"]
}

SELECT
  MAX(sending_ts) as latest_message_ts,
  TIMESTAMP_DIFF(CURRENT_TIMESTAMP(), MAX(sending_ts), HOUR) as hours_lag
FROM ${ref("mass_messages")}
WHERE sending_date >= DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY)
HAVING hours_lag > 24