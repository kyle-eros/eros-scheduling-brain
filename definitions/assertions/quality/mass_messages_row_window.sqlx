config {
  type: "assertion",
  schema: "eros_assertions",
  name: "mass_messages_row_window"
}

-- Fail if any row is older than 14 days
SELECT 1 AS failing
FROM UNNEST([1]) AS _
WHERE EXISTS (
  SELECT 1
  FROM ${ref("mass_messages")}
  WHERE sending_date < DATE_SUB(CURRENT_DATE(), INTERVAL 14 DAY)
  LIMIT 1
)