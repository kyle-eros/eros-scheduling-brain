<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EROS Scheduler Hub - Dashboard Guide</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #e0e0e0;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            padding: 40px 20px;
            background: rgba(26, 26, 46, 0.8);
            border-radius: 20px;
            margin-bottom: 40px;
            border: 2px solid rgba(83, 92, 145, 0.3);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }

        h1 {
            font-size: 3em;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            text-shadow: 0 0 30px rgba(102, 126, 234, 0.5);
        }

        .subtitle {
            font-size: 1.3em;
            color: #9ca3af;
            margin-bottom: 20px;
        }

        .badge {
            display: inline-block;
            padding: 8px 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            margin-top: 10px;
        }

        .section {
            background: rgba(26, 26, 46, 0.6);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(83, 92, 145, 0.3);
            backdrop-filter: blur(10px);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .section:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.3);
        }

        h2 {
            font-size: 2em;
            margin-bottom: 20px;
            color: #667eea;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .icon {
            font-size: 1.2em;
        }

        h3 {
            font-size: 1.5em;
            margin: 25px 0 15px 0;
            color: #a78bfa;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .card {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            padding: 25px;
            border-radius: 12px;
            border: 1px solid rgba(102, 126, 234, 0.2);
            transition: all 0.3s ease;
        }

        .card:hover {
            border-color: rgba(102, 126, 234, 0.5);
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(118, 75, 162, 0.2) 100%);
            transform: scale(1.03);
        }

        .card-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #a78bfa;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-content {
            color: #d1d5db;
            font-size: 0.95em;
        }

        .workflow {
            display: flex;
            align-items: center;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 20px;
            margin: 30px 0;
        }

        .workflow-step {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(118, 75, 162, 0.2) 100%);
            padding: 25px;
            border-radius: 12px;
            border: 2px solid rgba(102, 126, 234, 0.3);
            text-align: center;
            flex: 1;
            min-width: 150px;
            max-width: 200px;
            transition: all 0.3s ease;
        }

        .workflow-step:hover {
            transform: translateY(-10px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
            border-color: rgba(102, 126, 234, 0.6);
        }

        .workflow-arrow {
            font-size: 2em;
            color: #667eea;
        }

        .step-number {
            display: inline-block;
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            line-height: 40px;
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .feature-list {
            list-style: none;
            padding-left: 0;
        }

        .feature-list li {
            padding: 12px 0;
            padding-left: 35px;
            position: relative;
            border-bottom: 1px solid rgba(83, 92, 145, 0.2);
        }

        .feature-list li:before {
            content: "✓";
            position: absolute;
            left: 0;
            color: #10b981;
            font-weight: bold;
            font-size: 1.3em;
        }

        .highlight {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(5, 150, 105, 0.2) 100%);
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #10b981;
            margin: 20px 0;
        }

        .warning {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.2) 0%, rgba(217, 119, 6, 0.2) 100%);
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #f59e0b;
            margin: 20px 0;
        }

        .danger {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.2) 0%, rgba(220, 38, 38, 0.2) 100%);
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #ef4444;
            margin: 20px 0;
        }

        .column-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .column-box {
            background: rgba(102, 126, 234, 0.1);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(102, 126, 234, 0.2);
            text-align: center;
        }

        .column-name {
            font-weight: bold;
            color: #a78bfa;
            margin-bottom: 5px;
        }

        .column-desc {
            font-size: 0.85em;
            color: #9ca3af;
        }

        code {
            background: rgba(0, 0, 0, 0.4);
            padding: 3px 8px;
            border-radius: 4px;
            color: #10b981;
            font-family: 'Courier New', monospace;
        }

        .menu-item {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.1) 100%);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 3px solid #10b981;
        }

        .menu-title {
            font-weight: bold;
            color: #10b981;
            font-size: 1.1em;
            margin-bottom: 5px;
        }

        footer {
            text-align: center;
            padding: 40px 20px;
            color: #6b7280;
            margin-top: 50px;
        }

        .status-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: bold;
            margin-left: 10px;
        }

        .status-active {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .status-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        .status-error {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2em;
            }

            .workflow {
                flex-direction: column;
            }

            .workflow-arrow {
                transform: rotate(90deg);
            }
        }

        .architecture-diagram {
            background: rgba(0, 0, 0, 0.3);
            padding: 30px;
            border-radius: 15px;
            margin: 30px 0;
            text-align: center;
        }

        .arch-layer {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.2) 0%, rgba(118, 75, 162, 0.2) 100%);
            padding: 20px;
            margin: 15px 0;
            border-radius: 10px;
            border: 2px solid rgba(102, 126, 234, 0.3);
        }

        .arch-arrow {
            font-size: 2em;
            color: #667eea;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>🚀 EROS Scheduler Hub</h1>
            <p class="subtitle">Complete Dashboard Guide & Visual Workflow</p>
            <span class="badge">v2.0 - Production Ready</span>
        </header>

        <!-- Overview Section -->
        <div class="section">
            <h2><span class="icon">📊</span> Dashboard Overview</h2>
            <p>The EROS Scheduler Hub is your command center for managing OnlyFans creator messaging schedules. It combines AI-powered recommendations with smart guardrails to maximize revenue while maintaining authenticity.</p>

            <div class="highlight">
                <strong>🎯 Key Benefit:</strong> Automate 90% of scheduling decisions while maintaining full control and compliance with tier-based pricing rules.
            </div>

            <div class="grid">
                <div class="card">
                    <div class="card-title">🎨 9 Specialized Sheets</div>
                    <div class="card-content">Each sheet serves a specific purpose in your workflow, from daily planning to performance analytics.</div>
                </div>
                <div class="card">
                    <div class="card-title">🔐 RBAC Protected</div>
                    <div class="card-content">Only see creators assigned to you. Managers get additional override capabilities.</div>
                </div>
                <div class="card">
                    <div class="card-title">⚡ Real-Time Validation</div>
                    <div class="card-content">Preflight checks validate spacing, pricing, and fatigue before you submit.</div>
                </div>
                <div class="card">
                    <div class="card-title">📈 BigQuery Powered</div>
                    <div class="card-content">All data flows from curated BigQuery tables with 15-minute refresh cycles.</div>
                </div>
            </div>
        </div>

        <!-- Architecture -->
        <div class="section">
            <h2><span class="icon">🏗️</span> System Architecture</h2>
            <div class="architecture-diagram">
                <div class="arch-layer">
                    <strong>📊 UI Layer</strong><br>
                    Google Sheets + Apps Script (TypeScript compiled)
                </div>
                <div class="arch-arrow">⬇️</div>
                <div class="arch-layer">
                    <strong>🔍 Services Layer</strong><br>
                    BigQuery Service | Data Service | Preflight Service | Logging Service | Override Service
                </div>
                <div class="arch-arrow">⬇️</div>
                <div class="arch-layer">
                    <strong>💾 Data Layer</strong><br>
                    BigQuery Tables (Dataform Curated) | Partition-Optimized Queries
                </div>
                <div class="arch-arrow">⬇️</div>
                <div class="arch-layer">
                    <strong>📝 Audit Layer</strong><br>
                    eros_ops.send_log | eros_ops_stg.scheduler_overrides_ext
                </div>
            </div>
        </div>

        <!-- Workflow -->
        <div class="section">
            <h2><span class="icon">🔄</span> Daily Workflow</h2>
            <div class="workflow">
                <div class="workflow-step">
                    <div class="step-number">1</div>
                    <strong>Load Today</strong>
                    <p style="font-size: 0.9em; margin-top: 10px;">Fetch AI recommendations from BigQuery</p>
                </div>
                <div class="workflow-arrow">→</div>
                <div class="workflow-step">
                    <div class="step-number">2</div>
                    <strong>Review & Edit</strong>
                    <p style="font-size: 0.9em; margin-top: 10px;">Adjust prices, times, add captions</p>
                </div>
                <div class="workflow-arrow">→</div>
                <div class="workflow-step">
                    <div class="step-number">3</div>
                    <strong>Run Preflight</strong>
                    <p style="font-size: 0.9em; margin-top: 10px;">Validate against rules</p>
                </div>
                <div class="workflow-arrow">→</div>
                <div class="workflow-step">
                    <div class="step-number">4</div>
                    <strong>Submit</strong>
                    <p style="font-size: 0.9em; margin-top: 10px;">Log to BigQuery for execution</p>
                </div>
            </div>
        </div>

        <!-- Sheets Guide -->
        <div class="section">
            <h2><span class="icon">📑</span> Sheet-by-Sheet Guide</h2>

            <h3>1. 🏠 Control Hub</h3>
            <p>Your at-a-glance dashboard showing key metrics for today.</p>
            <div class="column-grid">
                <div class="column-box">
                    <div class="column-name">My Creators Today</div>
                    <div class="column-desc">Count of assigned creators</div>
                </div>
                <div class="column-box">
                    <div class="column-name">Total Slots</div>
                    <div class="column-desc">Mandatory + Optional</div>
                </div>
                <div class="column-box">
                    <div class="column-name">Est Revenue</div>
                    <div class="column-desc">Sum of suggested prices</div>
                </div>
                <div class="column-box">
                    <div class="column-name">Avg Confidence</div>
                    <div class="column-desc">AI prediction score</div>
                </div>
            </div>

            <h3>2. ✅ Today Planner <span class="status-badge status-active">PRIMARY WORKSPACE</span></h3>
            <p>Your main working surface. Edit this sheet to schedule messages.</p>

            <div class="warning">
                <strong>⚠️ Important:</strong> This sheet has 26 columns. The first 10 are editable, the rest are helper metadata.
            </div>

            <h4>Editable Columns (A-J):</h4>
            <div class="column-grid">
                <div class="column-box">
                    <div class="column-name">A: Local Time</div>
                    <div class="column-desc">HH:MM format (24-hour)</div>
                </div>
                <div class="column-box">
                    <div class="column-name">B: Creator</div>
                    <div class="column-desc">Username (read-only)</div>
                </div>
                <div class="column-box">
                    <div class="column-name">C: Page Handle</div>
                    <div class="column-desc">OF page identifier</div>
                </div>
                <div class="column-box">
                    <div class="column-name">D: Page Type</div>
                    <div class="column-desc">main/premium/free</div>
                </div>
                <div class="column-box">
                    <div class="column-name">E: Tier</div>
                    <div class="column-desc">A_FREE, B_PAID, etc.</div>
                </div>
                <div class="column-box">
                    <div class="column-name">F: Message Type</div>
                    <div class="column-desc">drip_bump, ppv, etc.</div>
                </div>
                <div class="column-box">
                    <div class="column-name">G: Subtype</div>
                    <div class="column-desc">Content category</div>
                </div>
                <div class="column-box">
                    <div class="column-name">H: Price ($)</div>
                    <div class="column-desc">⚠️ Validated on submit</div>
                </div>
                <div class="column-box">
                    <div class="column-name">I: Status</div>
                    <div class="column-desc">Planned/Ready/Sent</div>
                </div>
                <div class="column-box">
                    <div class="column-name">J: Notes</div>
                    <div class="column-desc">Your comments</div>
                </div>
            </div>

            <h4>Helper Columns (K-Z):</h4>
            <ul class="feature-list">
                <li><strong>Caption ID & Text:</strong> Auto-populated from Caption Picker sidebar</li>
                <li><strong>Tracking Hash:</strong> Unique identifier for audit trail</li>
                <li><strong>Score & Confidence:</strong> AI recommendation strength (0-100%)</li>
                <li><strong>Fatigue Score:</strong> Safety metric (30% = caution, 70%+ = safe)</li>
                <li><strong>Spacing OK:</strong> ✅ or ⚠️ based on minimum 60-minute rule</li>
                <li><strong>Mandatory:</strong> "Yes" if this message is tier-required</li>
            </ul>

            <h3>3. 📅 Week Planner</h3>
            <p>7-day capacity planning with revenue forecasts.</p>
            <div class="highlight">
                Shows daily breakdown: Drips, Renewals, PPVs, Tips, Est Revenue, Fatigue Risk
            </div>

            <h3>4. ⚠️ Risk Console</h3>
            <p>Authenticity alerts for creators showing suspicious patterns.</p>
            <ul class="feature-list">
                <li>Exact time repetitions (pattern detection risk)</li>
                <li>Low spacing variance (looks automated)</li>
                <li>High message frequency (burnout risk)</li>
            </ul>

            <h3>5. 💬 Caption Studio</h3>
            <p>Browse and select AI-generated captions. Usually accessed via sidebar.</p>

            <h3>6. 📊 Performance Pulse</h3>
            <p>7-day rolling metrics for your portfolio.</p>
            <div class="column-grid">
                <div class="column-box">
                    <div class="column-name">Messages Sent</div>
                    <div class="column-desc">Total volume</div>
                </div>
                <div class="column-box">
                    <div class="column-name">Revenue</div>
                    <div class="column-desc">Sum of prices</div>
                </div>
                <div class="column-box">
                    <div class="column-name">Avg Spacing</div>
                    <div class="column-desc">Pattern health</div>
                </div>
            </div>

            <h3>7. 📝 Action Log</h3>
            <p>Last 200 submissions from <code>eros_ops.send_log</code></p>
            <div class="warning">
                <strong>Audit Trail:</strong> Every submit action is logged here with timestamp, user, and tracking hash.
            </div>

            <h3>8. 🎯 Diagnostics</h3>
            <p>Preflight validation results appear here.</p>
            <div class="danger">
                <strong>Red Flags:</strong>
                <ul class="feature-list">
                    <li>Price outside tier guardrail</li>
                    <li>Spacing violations (&lt;60 min)</li>
                    <li>High fatigue (&lt;30% safety score)</li>
                    <li>Missing mandatory messages</li>
                </ul>
            </div>

            <h3>9. ⚙️ Settings</h3>
            <p>Configuration key-value pairs.</p>
            <div class="column-grid">
                <div class="column-box">
                    <div class="column-name">AUTO_REFRESH_MINUTES</div>
                    <div class="column-desc">Trigger interval (default: 15)</div>
                </div>
                <div class="column-box">
                    <div class="column-name">ENABLE_CACHE</div>
                    <div class="column-desc">BigQuery result caching</div>
                </div>
            </div>
        </div>

        <!-- Menu Guide -->
        <div class="section">
            <h2><span class="icon">🍔</span> Menu Functions</h2>
            <p>Access via: <code>🚀 EROS Scheduler Hub</code> menu</p>

            <div class="menu-item">
                <div class="menu-title">📂 Open Sidebar</div>
                Shows Caption Picker interface - click to browse captions by creator/hour
            </div>

            <div class="menu-item">
                <div class="menu-title">📅 Load Today</div>
                Fetches fresh recommendations from BigQuery, refreshes Control Hub, Risk Console, Performance
            </div>

            <div class="menu-item">
                <div class="menu-title">📆 Load Week</div>
                Populates Week Planner with 7-day forecast
            </div>

            <div class="menu-item">
                <div class="menu-title">🎲 Randomize Minutes (±15)</div>
                Adds random offset to selected time slots to avoid detection patterns
            </div>

            <div class="menu-item">
                <div class="menu-title">✅ Run Preflight</div>
                Validates all rows against spacing, pricing, fatigue, mandatory rules → outputs to Diagnostics
            </div>

            <div class="menu-item">
                <div class="menu-title">📤 Submit Ready/Sent</div>
                <div class="danger" style="margin-top: 10px;">
                    <strong>⚠️ Price Guard Active:</strong> Validates prices against tier bands. Non-managers blocked on violations. Managers prompted for override reason.
                </div>
                Writes all rows marked "Ready" or "Sent" to <code>eros_ops.send_log</code> in BigQuery
            </div>

            <div class="menu-item">
                <div class="menu-title">📊 Refresh Logs</div>
                Reloads Action Log sheet with latest 200 records
            </div>

            <div class="menu-item">
                <div class="menu-title">📈 Refresh Performance</div>
                Updates Performance Pulse metrics
            </div>

            <div class="menu-item">
                <div class="menu-title">⏰ Install 15m Refresh Trigger</div>
                Creates automatic trigger to refresh Home every 15 minutes
            </div>
        </div>

        <!-- Price Guard Feature -->
        <div class="section">
            <h2><span class="icon">🛡️</span> Price Guard System</h2>
            <div class="highlight">
                <strong>🎯 Purpose:</strong> Prevent accidental revenue loss from off-tier pricing
            </div>

            <h3>How It Works:</h3>
            <div class="workflow">
                <div class="workflow-step">
                    <div class="step-number">1</div>
                    <strong>Submit Clicked</strong>
                    <p style="font-size: 0.9em; margin-top: 10px;">User clicks "Submit Ready/Sent"</p>
                </div>
                <div class="workflow-arrow">→</div>
                <div class="workflow-step">
                    <div class="step-number">2</div>
                    <strong>Price Check</strong>
                    <p style="font-size: 0.9em; margin-top: 10px;">Compare vs tier templates</p>
                </div>
                <div class="workflow-arrow">→</div>
                <div class="workflow-step">
                    <div class="step-number">3</div>
                    <strong>Violation?</strong>
                    <p style="font-size: 0.9em; margin-top: 10px;">Outside [min, max] range?</p>
                </div>
                <div class="workflow-arrow">→</div>
                <div class="workflow-step">
                    <div class="step-number">4</div>
                    <strong>Block/Override</strong>
                    <p style="font-size: 0.9em; margin-top: 10px;">Non-manager: ❌ Manager: ✅ with reason</p>
                </div>
            </div>

            <h3>Example Tier Bands:</h3>
            <div class="column-grid">
                <div class="column-box">
                    <div class="column-name">Premium ($)</div>
                    <div class="column-desc">$25-$75</div>
                </div>
                <div class="column-box">
                    <div class="column-name">Mid ($)</div>
                    <div class="column-desc">$15-$35</div>
                </div>
                <div class="column-box">
                    <div class="column-name">Teaser ($)</div>
                    <div class="column-desc">$5-$15</div>
                </div>
            </div>

            <div class="warning">
                <strong>⚠️ Manager Override:</strong>
                <ul class="feature-list">
                    <li>Prompts for justification reason (required)</li>
                    <li>Logs to <code>eros_ops_stg.scheduler_overrides_ext</code></li>
                    <li>Includes: timestamp, creator, tier, price, reason, approver</li>
                    <li>Full audit trail for compliance</li>
                </ul>
            </div>
        </div>

        <!-- Caption Picker -->
        <div class="section">
            <h2><span class="icon">💬</span> Caption Picker Sidebar</h2>
            <p>AI-powered caption suggestions ranked by predicted engagement.</p>

            <h3>Usage:</h3>
            <ul class="feature-list">
                <li>Click "Open Sidebar" from menu</li>
                <li>Enter creator username</li>
                <li>Select hour of day (0-23)</li>
                <li>Click "Get Suggestions"</li>
                <li>Browse ranked captions with confidence scores</li>
                <li>Select row in Today Planner sheet</li>
                <li>Click "Apply to selected row" on chosen caption</li>
            </ul>

            <h3>Caption Sources (in priority order):</h3>
            <div class="grid">
                <div class="card">
                    <div class="card-title">🥇 24h Ranked Table</div>
                    <div class="card-content">High confidence - Optimized for specific hour/creator combo</div>
                </div>
                <div class="card">
                    <div class="card-title">🥈 By-Type Fallback</div>
                    <div class="card-content">Medium confidence - Type-specific captions</div>
                </div>
                <div class="card">
                    <div class="card-title">🥉 Caption Bank</div>
                    <div class="card-content">Low confidence - General time-of-day captions</div>
                </div>
            </div>
        </div>

        <!-- Data Flow -->
        <div class="section">
            <h2><span class="icon">🔄</span> Data Flow</h2>

            <h3>Read Path (BigQuery → Sheets):</h3>
            <div class="architecture-diagram">
                <div class="arch-layer">
                    <code>eros_messaging_mart.enhanced_daily_recommendations</code>
                </div>
                <div class="arch-arrow">⬇️</div>
                <div class="arch-layer">
                    BigQueryService.query() + 15min cache
                </div>
                <div class="arch-arrow">⬇️</div>
                <div class="arch-layer">
                    DataService.getTodayPlan() - filters by SESSION_USER()
                </div>
                <div class="arch-arrow">⬇️</div>
                <div class="arch-layer">
                    TodayPlanner.render() → Writes to sheet rows
                </div>
            </div>

            <h3>Write Path (Sheets → BigQuery):</h3>
            <div class="architecture-diagram">
                <div class="arch-layer">
                    User edits "Today Planner" sheet
                </div>
                <div class="arch-arrow">⬇️</div>
                <div class="arch-layer">
                    Marks rows as "Ready" or "Sent"
                </div>
                <div class="arch-arrow">⬇️</div>
                <div class="arch-layer">
                    Clicks "Submit Ready/Sent" → Price validation
                </div>
                <div class="arch-arrow">⬇️</div>
                <div class="arch-layer">
                    LoggingService.submitActions() → Parameterized INSERT
                </div>
                <div class="arch-arrow">⬇️</div>
                <div class="arch-layer">
                    <code>eros_ops.send_log</code> (partitioned by action_date)
                </div>
            </div>
        </div>

        <!-- Advanced Features -->
        <div class="section">
            <h2><span class="icon">⚡</span> Advanced Features</h2>

            <div class="grid">
                <div class="card">
                    <div class="card-title">🔐 RBAC Filtering</div>
                    <div class="card-content">
                        <strong>How:</strong> Every query includes <code>WHERE LOWER(scheduler_email) = LOWER(SESSION_USER())</code>
                        <br><br>
                        <strong>Result:</strong> You only see creators assigned to you in <code>scheduler_assignments_final</code> table
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">⚡ Smart Caching</div>
                    <div class="card-content">
                        <strong>How:</strong> MD5 hash of query + params = cache key
                        <br><br>
                        <strong>TTL:</strong> 15 minutes (900 seconds)
                        <br><br>
                        <strong>Benefit:</strong> 10x faster repeat queries
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">🎲 Randomization</div>
                    <div class="card-content">
                        <strong>Purpose:</strong> Avoid OF pattern detection
                        <br><br>
                        <strong>Range:</strong> ±15 minutes from original time
                        <br><br>
                        <strong>Handles:</strong> Time wraparound (23:55 + 10 = 00:05)
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">📊 Preflight Engine</div>
                    <div class="card-content">
                        <strong>Checks:</strong>
                        <ul style="margin-top: 10px; padding-left: 20px;">
                            <li>Spacing ≥ 60 min</li>
                            <li>Fatigue ≥ 30%</li>
                            <li>Prices in tier bands</li>
                            <li>Mandatory coverage</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Troubleshooting -->
        <div class="section">
            <h2><span class="icon">🔧</span> Troubleshooting Guide</h2>

            <div class="danger">
                <strong>❌ "Error retrieving access token"</strong>
                <br><br>
                <strong>Solution:</strong> Re-authenticate Apps Script
                <br>
                Extensions → Apps Script → Run any function → Authorize
            </div>

            <div class="warning">
                <strong>⚠️ "No data loading"</strong>
                <br><br>
                <strong>Check:</strong>
                <ul class="feature-list">
                    <li>BigQuery Advanced Service enabled in Apps Script</li>
                    <li>You have assignments in <code>scheduler_assignments_final</code></li>
                    <li>Source tables have data for today</li>
                    <li>GCP project = "of-scheduler-proj"</li>
                </ul>
            </div>

            <div class="danger">
                <strong>🛑 "Price outside tier guardrail" blocks submit</strong>
                <br><br>
                <strong>Options:</strong>
                <ul class="feature-list">
                    <li>Adjust price to be within tier bands</li>
                    <li>Contact a manager for override approval</li>
                    <li>Check tier templates for correct ranges</li>
                </ul>
            </div>

            <div class="highlight">
                <strong>💡 Pro Tip:</strong> Open Apps Script Editor (Extensions → Apps Script) and check View → Logs for detailed error messages during troubleshooting.
            </div>
        </div>

        <!-- Best Practices -->
        <div class="section">
            <h2><span class="icon">⭐</span> Best Practices</h2>

            <div class="grid">
                <div class="card">
                    <div class="card-title">🌅 Start of Day</div>
                    <div class="card-content">
                        <ul style="padding-left: 20px;">
                            <li>Click "Load Today"</li>
                            <li>Review Control Hub metrics</li>
                            <li>Check Risk Console for alerts</li>
                            <li>Run "Run Preflight" early</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">✏️ Editing</div>
                    <div class="card-content">
                        <ul style="padding-left: 20px;">
                            <li>Use "Randomize Minutes" on all rows</li>
                            <li>Add captions via sidebar (not manual)</li>
                            <li>Keep notes for future reference</li>
                            <li>Don't edit read-only helper columns</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">🚀 Submission</div>
                    <div class="card-content">
                        <ul style="padding-left: 20px;">
                            <li>Always run preflight first</li>
                            <li>Mark complete batches as "Ready"</li>
                            <li>Submit in small batches (easier to verify)</li>
                            <li>Check Action Log after submit</li>
                        </ul>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">🌙 End of Day</div>
                    <div class="card-content">
                        <ul style="padding-left: 20px;">
                            <li>Review Performance Pulse</li>
                            <li>Check if all mandatories covered</li>
                            <li>Note any patterns in Risk Console</li>
                            <li>Plan for tomorrow's week view</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Security -->
        <div class="section">
            <h2><span class="icon">🔒</span> Security & Compliance</h2>

            <h3>Data Protection:</h3>
            <ul class="feature-list">
                <li><strong>Parameterized SQL:</strong> All queries use named parameters - zero SQL injection risk</li>
                <li><strong>Session-based Auth:</strong> Uses Google OAuth - no password storage</li>
                <li><strong>RBAC Filtering:</strong> Server-side enforcement via SESSION_USER()</li>
                <li><strong>Audit Logging:</strong> Every action tracked with timestamp and user</li>
            </ul>

            <h3>Manager Privileges:</h3>
            <div class="warning">
                <strong>Granted via database flag:</strong>
                <br><br>
                <code>is_manager = TRUE</code> in <code>scheduler_roster</code> or <code>scheduler_assignments</code>
                <br><br>
                <strong>Allows:</strong>
                <ul class="feature-list">
                    <li>Price override with required justification</li>
                    <li>View full team performance metrics</li>
                    <li>Access override audit logs</li>
                </ul>
            </div>

            <h3>Audit Trail:</h3>
            <div class="column-grid">
                <div class="column-box">
                    <div class="column-name">eros_ops.send_log</div>
                    <div class="column-desc">All submissions</div>
                </div>
                <div class="column-box">
                    <div class="column-name">scheduler_overrides_ext</div>
                    <div class="column-desc">Price overrides</div>
                </div>
                <div class="column-box">
                    <div class="column-name">Apps Script Logs</div>
                    <div class="column-desc">System events</div>
                </div>
            </div>
        </div>

        <footer>
            <p><strong>EROS Scheduler Hub v2</strong></p>
            <p>Deployed: October 1, 2025</p>
            <p>Built with TypeScript, Apps Script, and BigQuery</p>
            <p style="margin-top: 20px; color: #9ca3af;">
                🤖 Generated with Claude Code AI Assistant
            </p>
        </footer>
    </div>
</body>
</html>
